<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gerenciamento - Projeto Final</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: white;
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }

        .tab-button:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        /* Formul√°rio de Usu√°rio */
        .form-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }

        .form-group input.error {
            border-color: #f44336;
        }

        .form-group input.success {
            border-color: #4CAF50;
        }

        .error-message {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
            display: none;
            padding: 5px;
            background: #ffebee;
            border-radius: 4px;
            border-left: 3px solid #f44336;
        }

        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #FF9800, #F57C00);
            color: white;
        }

        /* Lista de Usu√°rios */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .user-card {
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #4CAF50;
        }

        .user-card h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4CAF50;
        }

        .user-info {
            display: grid;
            gap: 8px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
        }

        .info-label {
            font-weight: bold;
            color: #666;
        }

        .info-value {
            color: #333;
        }

        /* Se√ß√£o de Tarefas */
        .task-input {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .task-input input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .task-input button {
            padding: 15px 25px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .tasks-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            min-height: 300px;
        }

        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .task-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .task-item.completed {
            opacity: 0.7;
            background: #e8f5e8;
        }

        .task-text {
            flex: 1;
            cursor: pointer;
            user-select: none;
        }

        .task-text.completed {
            text-decoration: line-through;
            color: #666;
        }

        .task-actions {
            display: flex;
            gap: 10px;
        }

        .task-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .task-btn.edit {
            background: #2196F3;
            color: white;
        }

        .task-btn.delete {
            background: #f44336;
            color: white;
        }

        /* Estat√≠sticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(45deg, #6c5ce7, #a29bfe);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Mensagens */
        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
            text-align: center;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Estados vazios */
        .empty-state {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 60px;
            background: #f9f9f9;
            border-radius: 12px;
            border: 2px dashed #ddd;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .form-section {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .users-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Sistema de Gerenciamento</h1>
            <div class="subtitle">Projeto Final - Cadastro de Usu√°rios e Gerenciamento de Tarefas</div>
        </div>

        <div class="tabs">
            <button class="tab-button active" onclick="switchTab('usuarios')">üë• Usu√°rios</button>
            <button class="tab-button" onclick="switchTab('tarefas')">üìù Tarefas</button>
            <button class="tab-button" onclick="switchTab('estatisticas')">üìä Estat√≠sticas</button>
            <button class="tab-button" onclick="switchTab('api')">üåê API Externa</button>
        </div>

        <!-- Aba Usu√°rios -->
        <div id="usuarios-tab" class="tab-content active">
            <h2>üë§ Cadastro de Usu√°rios</h2>
            
            <div class="message" id="user-message"></div>

            <form id="userForm">
                <div class="form-section">
                    <div>
                        <div class="form-group">
                            <label for="nomeUsuario">Nome de Usu√°rio:</label>
                            <input type="text" id="nomeUsuario" name="nomeUsuario" placeholder="Digite seu nome de usu√°rio">
                            <div class="error-message" id="errorNome"></div>
                        </div>

                        <div class="form-group">
                            <label for="senha">Senha:</label>
                            <input type="password" id="senha" name="senha" placeholder="Digite sua senha">
                            <div class="error-message" id="errorSenha"></div>
                        </div>

                        <div class="form-group">
                            <label for="telefone">Telefone:</label>
                            <input type="tel" id="telefone" name="telefone" placeholder="(11) 99999-9999">
                            <div class="error-message" id="errorTelefone"></div>
                        </div>
                    </div>

                    <div>
                        <div class="form-group">
                            <label for="dataNascimento">Data de Nascimento:</label>
                            <input type="date" id="dataNascimento" name="dataNascimento">
                            <div class="error-message" id="errorData"></div>
                        </div>

                        <div class="form-group">
                            <label for="email">E-mail:</label>
                            <input type="email" id="email" name="email" placeholder="seu@email.com">
                            <div class="error-message" id="errorEmail"></div>
                        </div>
                    </div>
                </div>

                <div class="form-buttons">
                    <button type="submit" class="btn btn-primary">Cadastrar Usu√°rio</button>
                    <button type="button" class="btn btn-secondary" onclick="clearUsersList()">Limpar Lista</button>
                </div>
            </form>

            <div class="users-grid" id="usersGrid">
                <div class="empty-state">
                    Nenhum usu√°rio cadastrado ainda. Preencha o formul√°rio acima para adicionar o primeiro usu√°rio!
                </div>
            </div>
        </div>

        <!-- Aba Tarefas -->
        <div id="tarefas-tab" class="tab-content">
            <h2>üìù Gerenciamento de Tarefas</h2>

            <div class="task-input">
                <input type="text" id="taskInput" placeholder="Digite uma nova tarefa..." maxlength="100">
                <button onclick="addTask()">Adicionar</button>
            </div>

            <div class="tasks-container" id="tasksContainer">
                <div class="empty-state">
                    Nenhuma tarefa adicionada ainda. Use o campo acima para criar sua primeira tarefa!
                </div>
            </div>

            <div class="form-buttons">
                <button type="button" class="btn btn-warning" onclick="clearAllTasks()">Limpar Todas</button>
                <button type="button" class="btn btn-secondary" onclick="exportTasks()">Exportar</button>
            </div>
        </div>

        <!-- Aba Estat√≠sticas -->
        <div id="estatisticas-tab" class="tab-content">
            <h2>üìä Estat√≠sticas do Sistema</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="totalUsers">0</span>
                    <span class="stat-label">Usu√°rios Cadastrados</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalTasks">0</span>
                    <span class="stat-label">Total de Tarefas</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="completedTasks">0</span>
                    <span class="stat-label">Tarefas Conclu√≠das</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="pendingTasks">0</span>
                    <span class="stat-label">Tarefas Pendentes</span>
                </div>
            </div>

            <div class="form-buttons">
                <button type="button" class="btn btn-primary" onclick="updateStats()">Atualizar Estat√≠sticas</button>
                <button type="button" class="btn btn-secondary" onclick="resetAllData()">Reset Completo</button>
            </div>
        </div>

        <!-- Aba API Externa -->
        <div id="api-tab" class="tab-content">
            <h2>üåê Integra√ß√£o com API Externa</h2>

            <div class="message" id="api-message"></div>
            <div class="loading" id="api-loading">
                <div class="spinner"></div>
                Carregando dados da API...
            </div>

            <div class="form-buttons">
                <button type="button" class="btn btn-primary" onclick="fetchUsers()">Buscar Usu√°rios</button>
                <button type="button" class="btn btn-secondary" onclick="fetchTodos()">Buscar Tarefas</button>
                <button type="button" class="btn btn-warning" onclick="postUserData()">Enviar Dados</button>
                <button type="button" class="btn btn-danger" onclick="clearApiData()">Limpar</button>
            </div>

            <div id="apiResults" class="users-grid">
                <div class="empty-state">
                    Clique nos bot√µes acima para buscar dados da API externa (JSONPlaceholder)
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==============================================
        // VARI√ÅVEIS GLOBAIS E CONFIGURA√á√ÉO
        // ==============================================
        
        // Chaves do Local Storage
        const STORAGE_KEYS = {
            users: 'sistema_usuarios',
            tasks: 'sistema_tarefas'
        };

        // URLs da API externa
        const API_BASE = 'https://60c2d84a917002001739d943.mockapi.io/api/';

        // Dados em mem√≥ria
        let users = [];
        let tasks = [];

        // ==============================================
        // CLASSES DE ERRO PERSONALIZADAS
        // ==============================================
        
        class ValidationError extends Error {
            constructor(field, message) {
                super(message);
                this.name = 'ValidationError';
                this.field = field;
            }
        }

        class AgeError extends Error {
            constructor(message) {
                super(message);
                this.name = 'AgeError';
                this.field = 'data';
            }
        }

        // ==============================================
        // FUN√á√ïES DE UTILIDADE
        // ==============================================
        
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('pt-BR');
        }

        function showMessage(elementId, message, type = 'success') {
            const messageEl = document.getElementById(elementId);
            messageEl.textContent = message;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }

        function clearErrors() {
            document.querySelectorAll('.error-message').forEach(error => {
                error.style.display = 'none';
            });
            
            document.querySelectorAll('input').forEach(input => {
                input.classList.remove('error', 'success');
            });
        }

        function showError(field, message) {
            const errorEl = document.getElementById(`error${field.charAt(0).toUpperCase() + field.slice(1)}`);
            const inputEl = document.getElementById(field) || document.getElementById('dataNascimento');
            
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.style.display = 'block';
                inputEl.classList.add('error');
            }
        }

        // ==============================================
        // SISTEMA DE ABAS
        // ==============================================
        
        function switchTab(tabName) {
            // Ocultar todas as abas
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar aba selecionada
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event.target.classList.add('active');
            
            // Atualizar dados espec√≠ficos da aba
            if (tabName === 'estatisticas') {
                updateStats();
            }
        }

        // ==============================================
        // PERSIST√äNCIA DE DADOS (LOCAL STORAGE)
        // ==============================================
        
        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                console.log(`Dados salvos: ${key}`, data);
            } catch (error) {
                console.error('Erro ao salvar no localStorage:', error);
                alert('Erro ao salvar dados localmente!');
            }
        }

        function loadFromStorage(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : [];
            } catch (error) {
                console.error('Erro ao carregar do localStorage:', error);
                return [];
            }
        }

        // ==============================================
        // VALIDA√á√ÉO DE FORMUL√ÅRIOS
        // ==============================================
        
        function validateUser(userData) {
            // Validar nome
            if (!userData.nome || userData.nome.trim().length < 2) {
                throw new ValidationError('nome', 'Nome deve ter pelo menos 2 caracteres.');
            }
            
            if (!/^[a-zA-Z√Ä-√ø\s]+$/.test(userData.nome.trim())) {
                throw new ValidationError('nome', 'Nome deve conter apenas letras.');
            }

            // Validar senha
            if (!userData.senha || userData.senha.length < 6) {
                throw new ValidationError('senha', 'Senha deve ter pelo menos 6 caracteres.');
            }

            // Validar telefone
            if (!userData.telefone || userData.telefone.trim().length === 0) {
                throw new ValidationError('telefone', 'Telefone √© obrigat√≥rio.');
            }

            // Validar email
            if (!userData.email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(userData.email)) {
                throw new ValidationError('email', 'E-mail deve ter formato v√°lido.');
            }

            // Validar idade (18+)
            if (userData.dataNascimento) {
                const today = new Date();
                const birthDate = new Date(userData.dataNascimento);
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                if (age < 18) {
                    throw new AgeError(`Voc√™ deve ter pelo menos 18 anos. Idade atual: ${age} anos.`);
                }
            }
        }

        // ==============================================
        // GEST√ÉO DE USU√ÅRIOS
        // ==============================================
        
        function addUser(userData) {
            validateUser(userData);
            
            // Verificar duplicata
            const existingUser = users.find(u => 
                u.email.toLowerCase() === userData.email.toLowerCase() ||
                u.nome.toLowerCase() === userData.nome.toLowerCase()
            );
            
            if (existingUser) {
                throw new ValidationError('nome', 'Usu√°rio com este nome ou email j√° existe.');
            }

            const newUser = {
                id: generateId(),
                nome: userData.nome.trim(),
                email: userData.email.trim(),
                telefone: userData.telefone.trim(),
                dataNascimento: userData.dataNascimento,
                criadoEm: new Date().toISOString()
            };

            users.push(newUser);
            saveToStorage(STORAGE_KEYS.users, users);
            renderUsers();
            updateStats();
            
            return newUser;
        }

        function renderUsers() {
            const container = document.getElementById('usersGrid');
            
            if (users.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        Nenhum usu√°rio cadastrado ainda. Preencha o formul√°rio acima para adicionar o primeiro usu√°rio!
                    </div>
                `;
                return;
            }

            container.innerHTML = users.map(user => `
                <div class="user-card">
                    <h3>üë§ ${user.nome}</h3>
                    <div class="user-info">
                        <div class="info-row">
                            <span class="info-label">E-mail:</span>
                            <span class="info-value">${user.email}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Telefone:</span>
                            <span class="info-value">${user.telefone}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Nascimento:</span>
                            <span class="info-value">${formatDate(user.dataNascimento)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Cadastrado:</span>
                            <span class="info-value">${formatDate(user.criadoEm)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function clearUsersList() {
            if (users.length === 0) {
                showMessage('user-message', 'Lista j√° est√° vazia!', 'error');
                return;
            }

            if (confirm(`Remover todos os ${users.length} usu√°rios cadastrados?`)) {
                users = [];
                saveToStorage(STORAGE_KEYS.users, users);
                renderUsers();
                updateStats();
                showMessage('user-message', 'Lista de usu√°rios limpa com sucesso!', 'info');
            }
        }

        // ==============================================
        // GEST√ÉO DE TAREFAS
        // ==============================================
        
        function addTask() {
            const input = document.getElementById('taskInput');
            const taskText = input.value.trim();

            if (taskText === '') {
                alert('Digite uma tarefa v√°lida!');
                return;
            }

            const newTask = {
                id: generateId(),
                text: taskText,
                completed: false,
                createdAt: new Date().toISOString()
            };

            tasks.push(newTask);
            saveToStorage(STORAGE_KEYS.tasks, tasks);
            input.value = '';
            renderTasks();
            updateStats();
        }

        function renderTasks() {
            const container = document.getElementById('tasksContainer');
            
            if (tasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        Nenhuma tarefa adicionada ainda. Use o campo acima para criar sua primeira tarefa!
                    </div>
                `;
                return;
            }

            container.innerHTML = tasks.map(task => `
                <div class="task-item ${task.completed ? 'completed' : ''}">
                    <span class="task-text ${task.completed ? 'completed' : ''}" 
                          onclick="toggleTask('${task.id}')">${task.text}</span>
                    <div class="task-actions">
                        <button class="task-btn edit" onclick="editTask('${task.id}')">Editar</button>
                        <button class="task-btn delete" onclick="deleteTask('${task.id}')">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function toggleTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveToStorage(STORAGE_KEYS.tasks, tasks);
                renderTasks();
                updateStats();
            }
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                const newText = prompt('Editar tarefa:', task.text);
                if (newText && newText.trim() !== '') {
                    task.text = newText.trim();
                    saveToStorage(STORAGE_KEYS.tasks, tasks);
                    renderTasks();
                }
            }
        }

        function deleteTask(taskId) {
            if (confirm('Excluir esta tarefa?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                saveToStorage(STORAGE_KEYS.tasks, tasks);
                renderTasks();
                updateStats();
            }
        }

        function clearAllTasks() {
            if (tasks.length === 0) {
                alert('N√£o h√° tarefas para limpar!');
                return;
            }

            if (confirm(`Remover todas as ${tasks.length} tarefas?`)) {
                tasks = [];
                saveToStorage(STORAGE_KEYS.tasks, tasks);
                renderTasks();
                updateStats();
            }
        }

        function exportTasks() {
            if (tasks.length === 0) {
                alert('N√£o h√° tarefas para exportar!');
                return;
            }

            const exportData = {
                tasks: tasks,
                exportedAt: new Date().toISOString(),
                totalTasks: tasks.length,
                completedTasks: tasks.filter(t => t.completed).length
            };

            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `tarefas-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // ==============================================
        // SISTEMA DE ESTAT√çSTICAS
        // ==============================================
        
        function updateStats() {
            const totalUsers = users.length;
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.completed).length;
            const pendingTasks = totalTasks - completedTasks;

            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalTasks').textContent = totalTasks;
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('pendingTasks').textContent = pendingTasks;
        }

        function resetAllData() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso remover√° TODOS os dados (usu√°rios e tarefas). Continuar?')) {
                users = [];
                tasks = [];
                
                Object.values(STORAGE_KEYS).forEach(key => {
                    localStorage.removeItem(key);
                });
                
                renderUsers();
                renderTasks();
                updateStats();
                
                alert('‚úÖ Todos os dados foram removidos com sucesso!');
            }
        }

        // ==============================================
        // INTEGRA√á√ÉO COM API EXTERNA (FETCH API)
        // ==============================================
        
        async function showLoading(show = true) {
            document.getElementById('api-loading').style.display = show ? 'block' : 'none';
        }

        async function fetchUsers() {
            try {
                showLoading(true);
                showMessage('api-message', 'Buscando usu√°rios da API...', 'info');
                
                const response = await fetch(`${API_BASE}/users`);
                
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }
                
                const apiUsers = await response.json();
                
                const container = document.getElementById('apiResults');
                container.innerHTML = apiUsers.slice(0, 10).map(user => `
                    <div class="user-card">
                        <h3>üë§ ${user.username}</h3>
                        <div class="user-info">
                            <div class="info-row">
                                <span class="info-label">E-mail:</span>
                                <span class="info-value">${user.email}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Telefone:</span>
                                <span class="info-value">${user.phone}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Nascimento:</span>
                                <span class="info-value">${formatDate(user.birth)}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Cadastrado:</span>
                                <span class="info-value">${formatDate(user.createdAt)}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                showMessage('api-message', `${apiUsers.length} usu√°rios carregados da API!`, 'success');
                
            } catch (error) {
                console.error('Erro ao buscar usu√°rios:', error);
                showMessage('api-message', `Erro ao buscar usu√°rios: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function fetchTodos() {
            try {
                showLoading(true);
                showMessage('api-message', 'Buscando tarefas da API...', 'info');
                
                const response = await fetch(`${API_BASE}/todo`);
                
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }
                
                const apiTodos = await response.json();
                
                const container = document.getElementById('apiResults');
                container.innerHTML = apiTodos.map(todo => `
                    <div class="task-item ${todo.completed ? 'completed' : ''}">
                        <span class="task-text ${todo.completed ? 'completed' : ''}">${todo.title}</span>
                        <div class="task-actions">
                            <span class="task-btn edit">ID: ${todo.id}</span>
                            <span class="task-btn ${todo.completed ? 'edit' : 'delete'}">
                                ${todo.completed ? 'Conclu√≠da' : 'Pendente'}
                            </span>
                        </div>
                    </div>
                `).join('');
                
                showMessage('api-message', `${apiTodos.length} tarefas carregadas da API!`, 'success');
                
            } catch (error) {
                console.error('Erro ao buscar tarefas:', error);
                showMessage('api-message', `Erro ao buscar tarefas: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        async function postUserData() {
            if (users.length === 0) {
                showMessage('api-message', 'Nenhum usu√°rio para enviar. Cadastre usu√°rios primeiro!', 'error');
                return;
            }

            try {
                showLoading(true);
                showMessage('api-message', 'Enviando dados para a API...', 'info');
                
                Promise.all(users.map(element => {
                    return fetch(`${API_BASE}/users`, {
                        method: 'POST',
                        body: JSON.stringify({
                            username: element.nome,
                            email: element.email,
                            phone: element.telefone,
                            birth: element.dataNascimento,
                            createdAt: new Date(element.criadoEm).toISOString(),
                        }),
                        headers: {
                            'Content-type': 'application/json; charset=UTF-8',
                        },
                    });
                }));

                showMessage('api-message', `Dados enviados com sucesso!`, 'success');
                
            } catch (error) {
                console.error('Erro ao enviar dados:', error);
                showMessage('api-message', `Erro ao enviar dados: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        function clearApiData() {
            document.getElementById('apiResults').innerHTML = `
                <div class="empty-state">
                    Clique nos bot√µes acima para buscar dados da API externa (JSONPlaceholder)
                </div>
            `;
            showMessage('api-message', 'Dados da API limpos!', 'info');
        }

        // ==============================================
        // EVENT LISTENERS E INICIALIZA√á√ÉO
        // ==============================================
        
        // Event listener do formul√°rio de usu√°rio
        document.getElementById('userForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Previne o comportamento padr√£o
            
            console.log('Formul√°rio enviado - preventDefault() aplicado');
            
            try {
                clearErrors();
                
                const formData = new FormData(this);
                const userData = {
                    nome: formData.get('nomeUsuario'),
                    senha: formData.get('senha'),
                    telefone: formData.get('telefone'),
                    dataNascimento: formData.get('dataNascimento'),
                    email: formData.get('email')
                };
                
                const newUser = addUser(userData);
                
                // Marcar campos como v√°lidos
                document.querySelectorAll('input').forEach(input => {
                    input.classList.add('success');
                });
                
                showMessage('user-message', `Usu√°rio "${newUser.nome}" cadastrado com sucesso!`, 'success');
                this.reset();
                clearErrors();
                
            } catch (error) {
                console.error('Erro no cadastro:', error);
                
                if (error instanceof ValidationError || error instanceof AgeError) {
                    showError(error.field, error.message);
                } else {
                    showMessage('user-message', 'Erro inesperado no cadastro!', 'error');
                }
            }
        });

        // Event listener para tecla Enter no campo de tarefa
        document.getElementById('taskInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTask();
            }
        });

        // Limpar erros ao digitar
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', function() {
                this.classList.remove('error');
                const errorEl = document.querySelector(`#error${this.name.charAt(0).toUpperCase() + this.name.slice(1)}`);
                if (errorEl) {
                    errorEl.style.display = 'none';
                }
            });
        });

        // ==============================================
        // INICIALIZA√á√ÉO DA APLICA√á√ÉO
        // ==============================================
        
        window.addEventListener('load', function() {
            console.log('üöÄ Sistema de Gerenciamento iniciado!');
            
            // Carregar dados do localStorage
            users = loadFromStorage(STORAGE_KEYS.users);
            tasks = loadFromStorage(STORAGE_KEYS.tasks);
            
            // Renderizar dados existentes
            renderUsers();
            renderTasks();
            updateStats();
            
            // Focar no primeiro campo
            document.getElementById('nomeUsuario').focus();
            
            console.log('‚úÖ Aplica√ß√£o carregada com sucesso!');
            console.log(`üìä Dados carregados: ${users.length} usu√°rios, ${tasks.length} tarefas`);
        });
    </script>
</body>
</html>
